---
// src/pages/posts/index.astro

import BaseLayout from '../../layouts/BaseLayout.astro';
import { client, getImageUrl } from '../../../sanity/client'; // 수정된 경로

// 모든 post를 최신순으로 가져오는 쿼리 (생성일도 함께 가져오기)
const query = `*[_type == "post"] | order(publishedAt desc) {
  title,
  "slug": slug.current,
  publishedAt,
  excerpt,
  mainImage {
    asset->{
        _id,
        url
    },
    alt
  }
}`;

const posts: any[] = await client.fetch(query);

// 디버깅을 위한 로그
console.log('Posts with dates:', posts?.map((post: any) => ({
  title: post.title,
  publishedAt: post.publishedAt,
  _createdAt: post._createdAt
})));

if (!posts) {
  // return new Response(null, {
  //   status: 404,
  //   statusText: 'Not found'
  // });
}
---

<BaseLayout title="All Posts" description="A list of all the articles and posts on my blog.">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white mb-8">All Posts</h1>
        <div class="grid gap-8">
            {posts.map((post: any) => (
                <a href={`/posts/${post.slug}`} class="group block p-6 bg-white rounded-lg border border-gray-200 shadow-md hover:shadow-lg transition-shadow duration-300 dark:bg-gray-800 dark:border-gray-700">
                    <div class="flex-1">
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            {new Date(post.publishedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                        </p>
                        <h2 class="mt-2 text-2xl font-bold text-gray-900 dark:text-white">{post.title}</h2>
                        <p class="mt-3 text-base text-gray-600 dark:text-gray-300">{post.excerpt}</p>
                        <div class="mt-4 flex items-center text-primary-500 group-hover:underline dark:text-primary-400">
                            Read more
                            <span class="material-icons ml-1">arrow_forward</span>
                        </div>
                    </div>
                </a>
            ))}
        </div>
    </div>
</BaseLayout> 