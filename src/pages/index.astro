---
// src/pages/index.astro

// 1. 필요한 도구들을 불러옵니다.
import { client, getImageUrl } from '../../sanity/client';
import BaseLayout from '../layouts/BaseLayout.astro';

// 2. Sanity에 데이터를 요청하는 '요청서(GROQ 쿼리)'를 작성합니다.
// "post 타입의 문서를, 발행일 최신순으로 정렬해서, 3개만 가져와줘" 라는 뜻입니다.
const query = `*[_type == "post"] | order(publishedAt desc)[0...3] {
	title,
	"slug": slug.current,
	mainImage {
		asset->{
			_id,
			url
		},
		alt
	},
	excerpt
}`;

// 3. 실제로 Sanity에 데이터를 요청하고 결과를 posts 변수에 저장합니다.
const posts = await client.fetch(query);

// 만약 데이터가 없으면 빈 배열로 처리합니다.
if (!posts) {
	// return new Response(null, {
	//   status: 404,
	//   statusText: 'Not found'
	// });
}
---

<!-- 4. BaseLayout으로 전체 페이지를 감싸줍니다. title을 "Home"으로 설정합니다. -->
<BaseLayout title="Home | Tech Tales" description="일상에서 도움이 되는 정보와 경제 지식을 공유합니다.">
	<!-- main_page_ui.html의 구조를 가져옵니다. -->
	<div class="px-4 sm:px-6 md:px-20 lg:px-40 flex flex-1 justify-center py-8">
		<div class="layout-content-container flex flex-col max-w-4xl flex-1 gap-12">
			<section class="mt-12">
				<h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Latest Posts</h2>
				<div class="mt-6 grid grid-cols-1 gap-8">
					<!-- 5. Sanity에서 가져온 posts 데이터를 반복해서 화면에 표시합니다. -->
					{posts && posts.map((post: any) => (
						<a href={`/posts/${post.slug}`} class="group block p-6 bg-white rounded-lg border border-gray-200 shadow-md hover:shadow-lg transition-shadow duration-300 dark:bg-gray-800 dark:border-gray-700">
							<p class="text-sm text-gray-500 dark:text-gray-400">
								{new Date(post.publishedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
							</p>
							<h3 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">{post.title}</h3>
							<p class="mt-3 text-base text-gray-600 dark:text-gray-300">{post.excerpt}</p>
							<div class="mt-4 flex items-center text-primary-500 font-semibold group-hover:text-primary-600 dark:text-primary-400 dark:group-hover:text-primary-300">
								<span class="underline">Read more</span>
								<span class="material-icons ml-1">arrow_forward</span>
							</div>
						</a>
					))}
				</div>
			</section>
			<!-- "Popular Posts" 와 "About Me" 섹션은 나중에 추가하겠습니다. -->
		</div>
	</div>
</BaseLayout>
