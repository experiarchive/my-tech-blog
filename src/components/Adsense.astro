---
// src/components/Adsense.astro
export interface Props {
  slot: string; // ê´‘ê³  ë‹¨ìœ„ ìŠ¬ë¡¯ ID
  format?: string; // ê´‘ê³  í˜•ì‹ (ì„ íƒ ì‚¬í•­)
}
const { slot, format = 'auto' } = Astro.props;

const adClient = import.meta.env.PUBLIC_ADSENSE_CLIENT;
---

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client={adClient}
     data-ad-slot={slot}
     data-ad-format={format}
     data-full-width-responsive="true"></ins>
<script is:inline>
     // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì œí•œìœ¼ë¡œ ë¬´í•œë£¨í”„ ë°©ì§€
     let retryCount = 0;
     const MAX_RETRIES = 50; // 5ì´ˆ ì œí•œ (100ms * 50)
     
     function waitForAdSense() {
          console.log(`ğŸ” AdSense: Checking if script is loaded... (${retryCount}/${MAX_RETRIES})`);
          
          // ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ì¤‘ë‹¨
          if (retryCount >= MAX_RETRIES) {
               console.error('âŒ AdSense: Max retries exceeded, giving up');
               return;
          }
          
          // adsbygoogle ë°°ì—´ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ê³  ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸
          if (typeof window.adsbygoogle !== 'undefined' && Array.isArray(window.adsbygoogle)) {
               console.log('âœ… AdSense: Script ready, initializing ad');
               try {
                    window.adsbygoogle.push({});
                    console.log('âœ… AdSense: Push successful');
               } catch (error) {
                    console.error('âŒ AdSense: Push failed:', error);
               }
          } else {
               retryCount++;
               console.log('â³ AdSense: Script not ready, retrying...');
               setTimeout(waitForAdSense, 100);
          }
     }
     
     // DOM ë¡œë“œ í›„ ì‹œì‘
     if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', waitForAdSense);
     } else {
          waitForAdSense();
     }
</script> 