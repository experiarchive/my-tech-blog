name: Deploy on Sanity Update

on:
  repository_dispatch:
    types: [sanity-update]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Extract post info
        id: post_info
        run: |
          echo "action=${{ github.event.client_payload.action }}" >> $GITHUB_OUTPUT
          echo "title=${{ github.event.client_payload.document.title }}" >> $GITHUB_OUTPUT
          echo "slug=${{ github.event.client_payload.document.slug }}" >> $GITHUB_OUTPUT
          
      - name: Create deployment commit
        run: |
          ACTION="${{ steps.post_info.outputs.action }}"
          TITLE="${{ steps.post_info.outputs.title }}"
          SLUG="${{ steps.post_info.outputs.slug }}"
          
          case $ACTION in
            "create")
              COMMIT_MSG="ğŸ†• ìƒˆ í¬ìŠ¤íŠ¸ ë°œí–‰: $TITLE ($SLUG)"
              ;;
            "update")
              COMMIT_MSG="âœï¸ í¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸: $TITLE ($SLUG)"
              ;;
            "delete")
              COMMIT_MSG="ğŸ—‘ï¸ í¬ìŠ¤íŠ¸ ì‚­ì œ: $TITLE ($SLUG)"
              ;;
            *)
              COMMIT_MSG="ğŸ“ í¬ìŠ¤íŠ¸ ë³€ê²½: $TITLE ($SLUG)"
              ;;
          esac
          
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git commit --allow-empty -m "$COMMIT_MSG"
          git push 